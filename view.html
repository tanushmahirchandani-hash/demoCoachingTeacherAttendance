<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>View Attendance</title>
<link rel="stylesheet" href="style.css">
<script src="passwords.js"></script>
<script src="config.js"></script>
<script>
const PAGE="view.html";
if(PAGE_PASSWORDS[PAGE]){
  const entry=prompt("Enter password for Attendance Viewer:");
  if(entry!==PAGE_PASSWORDS[PAGE]){alert("Incorrect!");window.location.href="index.html";}
}
async function fetchData(){
  const resp=await fetch(WEBAPP_URL);
  const data=await resp.json();
  const table=document.getElementById("tableBody");
  table.innerHTML="";
  data.forEach(d=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${d.teacher}</td><td>${d.branch}</td><td>${d.date}</td><td>${d.time}</td>`;
    table.appendChild(tr);
  });
}
</script>
</head>
<body onload="fetchData()">
<div class="container">
<div class="header"><div class="logo">ðŸ“Š</div><div><h1 class="title">View Attendance</h1><div class="small">Read-only view</div></div></div>
<div class="card">
<form id="filterForm" onsubmit="event.preventDefault();filterData();">
  From: <input type="date" id="fromDate"/> To: <input type="date" id="toDate"/>
  Teacher: <input type="text" id="teacherFilter" placeholder="Teacher"/>
  <button>Filter</button>
</form>
<table>
<thead><tr><th>Teacher</th><th>Branch</th><th>Date</th><th>Time</th></tr></thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>
<script>
let allData=[];
async function fetchData(){
  const resp=await fetch(WEBAPP_URL);
  allData=await resp.json();
  renderTable(allData);
}
function renderTable(data){
  const table=document.getElementById("tableBody");
  table.innerHTML="";
  data.forEach(d=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${d.teacher}</td><td>${d.branch}</td><td>${d.date}</td><td>${d.time}</td>`;
    table.appendChild(tr);
  });
}
function filterData(){
  const from=document.getElementById("fromDate").value;
  const to=document.getElementById("toDate").value;
  const teacher=document.getElementById("teacherFilter").value.toLowerCase();
  let filtered=allData.filter(d=>{
    let valid=true;
    if(from) valid=valid && (d.date>=from);
    if(to) valid=valid && (d.date<=to);
    if(teacher) valid=valid && d.teacher.toLowerCase().includes(teacher);
    return valid;
  });
  renderTable(filtered);
}
</script>
</body>
</html>
